<?xml version="1.0" encoding="UTF-8" ?>
<config>

	<dataDir>${solr.data.dir:}</dataDir>

	<!--  The DirectoryFactory to use for indexes.
        solr.StandardDirectoryFactory, the default, is filesystem based.
        solr.RAMDirectoryFactory is memory based and not persistent. -->
	<directoryFactory name="DirectoryFactory" class="${solr.directoryFactory:solr.RAMDirectoryFactory}"/>

	<luceneMatchVersion>${tests.luceneMatchVersion:LUCENE_CURRENT}</luceneMatchVersion>

	<abortOnConfigurationError>${solr.abortOnConfigurationError:true}</abortOnConfigurationError>

	<indexConfig>
		<!-- this sys property is not set by SolrTestCaseJ4 because we ideally want to use
               the RandomMergePolicy in all tests - but some tests expect very specific
               Merge behavior, so those tests can set it as needed.
		-->
		<mergePolicy class="${solr.tests.mergePolicy:org.apache.solr.util.RandomMergePolicy}" />

		<useCompoundFile>${useCompoundFile:false}</useCompoundFile>

		<maxBufferedDocs>${solr.tests.maxBufferedDocs}</maxBufferedDocs>
		<maxIndexingThreads>${solr.tests.maxIndexingThreads}</maxIndexingThreads>
		<ramBufferSizeMB>${solr.tests.ramBufferSizeMB}</ramBufferSizeMB>

		<mergeScheduler class="${solr.tests.mergeScheduler}" />
		<nrtMode>${solr.tests.nrtMode:true}</nrtMode>

		<writeLockTimeout>1000</writeLockTimeout>
		<commitLockTimeout>10000</commitLockTimeout>

		<!-- this sys property is not set by SolrTestCaseJ4 because almost all tests should
               use the single process lockType for speed - but tests that explicitly need
               to vary the lockType canset it as needed.
		-->
		<lockType>${solr.tests.lockType:single}</lockType>
	</indexConfig>


	<updateHandler class="solr.DirectUpdateHandler2">
		<updateLog enable="${enable.update.log:true}">
			<str name="dir">${solr.ulog.dir:}</str>
		</updateLog>

		<commitWithin>
			<softCommit>${solr.commitwithin.softcommit:true}</softCommit>
		</commitWithin>
	</updateHandler>


	<query>
		<maxBooleanClauses>1024</maxBooleanClauses>

		<filterCache
			class="solr.FastLRUCache"
			size="512"
			initialSize="512"
			autowarmCount="256"/>

		<queryResultCache
			class="solr.LRUCache"
			size="512"
			initialSize="512"
			autowarmCount="0"/>

		<documentCache
			class="solr.LRUCache"
			size="512"
			initialSize="512"
			autowarmCount="0"/>

		<enableLazyFieldLoading>true</enableLazyFieldLoading>

		<queryResultWindowSize>20</queryResultWindowSize>

		<queryResultMaxDocsCached>200</queryResultMaxDocsCached>


		<listener event="newSearcher" class="solr.QuerySenderListener">
			<arr name="queries">

			</arr>
		</listener>

		<listener event="firstSearcher" class="solr.QuerySenderListener">
			<arr name="queries">

			</arr>
		</listener>

		<useColdSearcher>false</useColdSearcher>

		<maxWarmingSearchers>2</maxWarmingSearchers>
	</query>


	<requestDispatcher handleSelect="true" >
		<!--Make sure your system has some authentication!  -->
		<requestParsers enableRemoteStreaming="true" multipartUploadLimitInKB="2048000" />

		<httpCaching lastModifiedFrom="openTime" etagSeed="Solr" />
	</requestDispatcher>


	<requestHandler name="/select" class="solr.SearchHandler">
		<lst name="defaults">
			<str name="defType">edismax</str>
			<str name="echoParams">explicit</str>
			<str name="q.op">OR</str>
			<str name="qf">content^40.0 title^5.0 keywords^2.0 tagsH1^5.0 tagsH2H3^3.0 tagsH4H5H6^2.0 tagsInline^1.0</str>
			<str name="pf">content^2.0</str>
			<str name="df">content</str>
			<int name="ps">15</int>
	
			<str name="mm">2&lt;-35%</str>
	
			<str name="hl.fl">title,content</str>
			<int name="hl.snippets">3</int>
			<str name="hl.mergeContiguous">true</str>
			<str name="hl.requireFieldMatch">true</str>
	
			<str name="f.content.hl.alternateField">content</str>
			<str name="f.content.hl.maxAlternateFieldLength">200</str>
	
			<str name="spellcheck">false</str>
			<str name="spellcheck.onlyMorePopular">false</str>
			<str name="spellcheck.extendedResults">false</str>
			<str name="spellcheck.count">1</str>
		</lst>

		<arr name="last-components">
			<str>spellcheck</str>
		</arr>
	</requestHandler>


	<requestHandler name="/update" class="solr.XmlUpdateRequestHandler" />


	<searchComponent name="spellcheck" class="solr.SpellCheckComponent">
		<str name="queryAnalyzerFieldType">textSpell</str>

		<lst name="spellchecker">
			<str name="name">default</str>
			<str name="field">spell</str>
			<str name="buildOnCommit">true</str>
			<str name="spellcheckIndexDir">./spellchecker1</str>
		</lst>
	</searchComponent>


	<!-- http://wiki.apache.org/solr/HighlightingParameters -->
	<searchComponent name="highlight" class="solr.HighlightComponent">
		<highlighting>
			<fragmenter
				name="gap"
				default="true"
				class="solr.highlight.GapFragmenter">

				<lst name="defaults">
					<int name="hl.fragsize">100</int>
				</lst>

			</fragmenter>

			<fragmenter name="regex" class="solr.highlight.RegexFragmenter">
				<lst name="defaults">
					<int name="hl.fragsize">70</int>
					<float name="hl.regex.slop">0.5</float>
					<str name="hl.regex.pattern">[-\w ,/\n\&quot;&apos;]{20,200}</str>
				</lst>
			</fragmenter>

			<formatter
				name="html"
				default="true"
				class="solr.highlight.HtmlFormatter">

				<lst name="defaults">
					<str name="hl.simple.pre"><![CDATA[<em>]]></str>
					<str name="hl.simple.post"><![CDATA[</em>]]></str>
				</lst>
			</formatter>

			<encoder name="html" class="solr.highlight.HtmlEncoder" />

			<fragListBuilder
				name="simple"
				default="true"
				class="solr.highlight.SimpleFragListBuilder"/>

			<fragListBuilder
				name="single"
				class="solr.highlight.SingleFragListBuilder"/>

			<fragmentsBuilder
				name="default"
				default="true"
				class="solr.highlight.ScoreOrderFragmentsBuilder"/>

			<fragmentsBuilder
				name="colored"
				class="solr.highlight.ScoreOrderFragmentsBuilder">

				<lst name="defaults">
					<str name="hl.tag.pre">
						<![CDATA[
						<b style="background:yellow">,<b style="background:lawgreen">,
						<b style="background:aquamarine">,<b style="background:magenta">,
						<b style="background:palegreen">,<b style="background:coral">,
						<b style="background:wheat">,<b style="background:khaki">,
						<b style="background:lime">,<b style="background:deepskyblue">
						]]>
					</str>
					<str name="hl.tag.post"><![CDATA[</b>]]></str>
				</lst>
			</fragmentsBuilder>
		</highlighting>
	</searchComponent>


	<!-- TYPO3 specific plugins, request handlers -->
	<queryParser name="typo3access" class="org.typo3.solr.search.AccessFilterQParserPlugin"/>


	<admin>
		<defaultQuery>*:*</defaultQuery>
	</admin>

</config>